{% load bootstrap4 %}
{% load humanize %}
{% block content %}
{% load mathfilters %}

<style>
    .mesmo-tamanho {
        width: 15%;
        white-space: normal;
    }
</style>
<br />
<div class="container-fluid tabini sombra" align=center>
    <br />
    <h4 class="container" align=left> <strong>Resumo Pedidos</strong></h4>
    <hr />
    <div class="my-table" style="zoom:67%">
        <table id="dtBasicExample"
            class="width table table-condensed table-striped table-hover table-dark table-bordered table-sm" width=100>
            <thead>
                <tr>
                    <th scope="col">Contrato</th>
                    <th scope="col">Situação</th>
                    <th scope="col">Data</th>
                    <th scope="col">Fornecedor</th>
                    <th scope="col">Origem </th>
                    <th scope="col">Cliente</th>
                    <th scope="col">Preço</th>
                    <th scope="col">Produto</th>
                    <th scope="col">Tipo</th>
                    <th scope="col">Frete</th>
                    <th scope="col">Quantidade</th>
                    <th scope="col">Quantidade Kg </th>
                    <th scope="col">Carregado</th>
                    <th scope="col">Saldo Real</th>
                    <th scope="col">Previsto</th>
                    <th scope="col">Saldo Prev.</th>
                    {% if user.is_superuser%}
                    <th scope="col">Comiss</th>
                    {% endif %}
                    <th scope="col">Ação</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}

                <tr>
                    {% if pedido.carregado %}
                    <td><a class="text" href="{% url 'detail_cargas' pedido.pk %}" target="_blank"
                            style='font-style:italic; color: blanchedalmond; text-decoration: underline;'><strong>{{ pedido.contrato }}</strong></a>
                    </td>
                    {% else %}
                    <td><a class="text text-white"
                            style='font-style:italic; '><strong>{{ pedido.contrato }}</strong></a>
                    </td>
                    {% endif %}
                    {% if pedido.situacao == 'a' %}
                    <td class="text-success text-center"><strong>Aberto</strong></td>
                    {% elif pedido.situacao == 'b' %}
                    <td class="text-danger text-center"><strong>Fechado</strong></td>
                    {% elif pedido.situacao == 'c' %}
                    <td class="text-danger text-center"><strong>Cancelado</strong></td>
                    {% else %}
                    {% endif %}

                    <td>{{ pedido.data|date:"SHORT_DATE_FORMAT" }}</td>
                    <td>{{ pedido.fornecedor|title|truncatechars:26 }}</td>
                    <td>{{ pedido.fornecedor.cidade|truncatechars:20 }}</td>

                    {% if 'CDA' in pedido.cliente.nome_fantasia|upper %}
                    <td class="text-danger">
                        <em><strong>{{ pedido.cliente|upper|truncatechars:10 }}</strong></em></td>
                    {% elif 'USTON' in pedido.cliente.nome_fantasia|upper %}
                    <td class="text-primary text-truncate">
                        <em><strong>{{ pedido.cliente|upper|truncatechars:10 }}</strong></em></td>
                    {% elif 'APIT' in pedido.cliente.nome_fantasia|upper %}
                    <td class="text-truncate" style="color: orange;">
                        <em><strong>{{ pedido.cliente|upper|truncatechars:10 }}</strong></em>
                    </td>
                    {% else %}
                    <td>{{ pedido.cliente|upper }}</td>
                    {% endif %}

                    <td>R$ {{ pedido.preco_produto|intcomma  }}</td>
                    <td> {{ pedido.produto  }} </td>
                    {% if pedido.produto == 'Arroz em Casca' %}
                    <td> Saco 50Kg </td>
                    {% else %}
                    <td> Fardo 30Kg </td>
                    {% endif %}



                    <td> R$ {{ pedido.preco_frete  }} </td>


                    {% if pedido.produto == "Arroz em Casca" %}
                    {% if pedido.ativo == True and pedido.situacao == 'a'%}
                    <td align=center class="text text-success">
                        <strong>{{ pedido.quantidade_pedido|div:50|floatformat:"0"}} Scs</strong>
                    </td>
                    {% else %}
                    <td align=center>{{ pedido.quantidade_pedido|div:50|floatformat:"0"}} Scs </td>
                    {% endif %}
                    {% else %}
                    {% if pedido.ativo == True and pedido.situacao == 'a' %}
                    <td align=center class="text text-success">
                        <strong>{{ pedido.quantidade_pedido|div:30|floatformat:"0"}} Fds</strong>
                    </td>
                    {% else %}
                    <td align=center>{{ pedido.quantidade_pedido|div:30|floatformat:"0"}} Fds </td>
                    {% endif %}
                    {% endif %}
                    <td align=center>{{ pedido.quantidade_pedido|intcomma }} Kg </td>
                    {% if pedido.carregado == 0 %}
                    <td align=center> - </td>
                    {% elif pedido.carregado == None %}
                    <td align=center> - </td>
                    {% else %}
                    <td align=center>{{ pedido.carregado }} Kg</td>
                    {% endif %}
                    {% if pedido.saldo == 0 %}
                    <td align=center> - </td>
                    {% elif pedido.saldo == None %}
                    <td align=center> - </td>
                    {% elif pedido.saldo < 0 %}
                    <td align=center class="text-danger"><strong>{{ pedido.saldo }} Kg</strong></td>
                    {% elif pedido.saldo > 25000 %}
                    <td align=center class="text-success"><strong>{{ pedido.saldo }} Kg</strong></td>
                    {% elif pedido.saldo > 0 %}
                    <td align=center class="text-warning"><strong>{{ pedido.saldo }} Kg</strong></td>

                    {% else %}
                    <td align=center>{{ pedido.saldo }} Kg</td>
                    {% endif %}
                    {% if pedido.previsto == 0 %}
                    <td align=center> - </td>
                    {% elif pedido.previsto == None %}
                    <td align=center> - </td>
                    {% else %}
                    <td align=center class="text-primary"><strong>{{ pedido.previsto }} Kg</strong></td>
                    {% endif %}
                    {% if pedido.saldoprevisto == 0 %}
                    <td align=center> - </td>
                    {% elif pedido.saldoprevisto == None %}
                    <td align=center> - </td>
                    {% elif pedido.saldoprevisto < 0 %}
                    <td align=center class="text-danger"><strong>{{ pedido.saldoprevisto }} Kg</strong> </td>
                    {% elif pedido.saldoprevisto < pedido.saldo %}
                    <td align=center class="text-warning"><strong>{{ pedido.saldoprevisto }} Kg</strong> </td>

                    {% else %}
                    <td align=center class="text-success"><strong>{{ pedido.saldoprevisto }} Kg</strong></td>
                    {% endif %}
                    {% if user.is_superuser %}
                    {% if pedido.produto == 'Arroz em Casca' and pedido.totalcomissaocasca != None and pedido.carregado %}
                    {% if pedido.comissaorecebida > 0 %}
                    <td class="text-center"><a href="{% url 'detail_cargas_comiss' pedido.pk %}" target="_blank"
                            style='font-style:italic;  color:#f0ad4e;'><b>R$
                                {{ pedido.totalcomissaocasca|floatformat:2 }}</b>
                        </a></td>
                    {% else %}
                    <td class="text-center"><a href="{% url 'detail_cargas_comiss' pedido.pk %}" target="_blank"
                            style='font-style:italic;  color:#5cb85c;'><b>R$
                                {{ pedido.totalcomissaocasca|floatformat:2 }}</b>
                        </a></td>
                    {% endif %}
                    {% else %}
                    <td class="text-center">-</td>
                    {% endif %}
                    {% endif %}
                    {% if pedido.carregado %}
                    <td>
                        <a class="btn btn-warning btn-xs" href="{% url 'upd_pedidos' pedido.pk %}">Editar</a>
                    </td>
                    {% else %}
                    <td>
                        <a class="btn btn-warning btn-xs" href="{% url 'upd_pedidos' pedido.pk %}">Editar</a>
                        <a class="btn btn-danger btn-xs" href="{% url 'del_pedidos' pedido.pk %}">Deletar</a>
                    </td>
                    {% endif %}

                </tr>

                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


{% endblock %}