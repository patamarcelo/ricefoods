{% load bootstrap4 %}
{% load humanize %}
{% load static %}
{% now "Y-m-d" as todays_date %}
{% load mathfilters %}


<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.7 shrink-to-fit=no">
    {% bootstrap_css %}
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="{% static 'css/mdb.min.css' %}">
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <!-- MDBootstrap Datatables  -->
    <link href="{% static 'css/addons/datatables.min.css' %}" rel="stylesheet">
    <style>
        .btn-xs {
            padding: 5px 10px;
            font-size: 10px;
            line-height: 1.0;

        }

        .my-table {
            overflow-x: auto;
            zoom: 80%;
        }

        table.width {
            width: 85%;
            margin: 20px auto;
            table-layout: auto;
            /* Optional */
            border-collapse: collapse;
            white-space: nowrap;

        }


        td {
            border: 1px solid #000;
        }


        .tab {
            position: absolute;
            right: 250px;
            margin-top: 10px;
        }

        td.border_bottom {
            border-bottom: 1pt solid black;
            border-collapse: collapse;
        }
    </style>
    <style>
        .table-hover>tbody>tr:hover>td,
        .table-hover>tbody>tr:hover>th {
            background-color: #a9a9a9;
            color: black;
        }

        body {
            background-color: white;
        }
    </style>

</head>


<div class="table-responsive table-width my-table">

    <body>
        <br><br>
        <div class="container">
            <div class="row">

                <div class="col" align="center">
                    <h2><span class="badge badge-primary badge-pill">
                            Contrato </span></h2>
                </div>

            </div>
        </div>

        <!--------------------------PEdidos---------------------------->
        <table class="width table table-sm table-borderless align-text-center " width=100>
            <thead class="thead-dark table-bordered">
                <tr align="center">

                    <th scope="col"><strong> Contrato</strong></th>
                    <th scope="col"><strong> Situação</strong></th>
                    <th scope="col"><strong> Data</strong></th>
                    <th scope="col"><strong> Fornecedor</strong></th>

                    <th scope="col"><strong> Cliente</strong></th>
                    <th scope="col"><strong> Preço</strong></th>
                    <th scope="col"><strong> Comissão</strong></th>
                    <th scope="col"><strong> Produto</strong></th>


                    <th scope="col"><strong> Quantidade</strong></th>
                    <th scope="col"><strong> Quantidade Kg </strong></th>
                    <th scope="col"><strong> Carregado</strong></th>
                    <th scope="col"><strong> Saldo</strong></th>
                </tr>

            </thead>
            <tbody class="table-bordered">
                {% for pedido in pedidos %}

                <tr align="center">
                    <td class="border_bottom"> <strong>{{ pedido.contrato }}</strong></td>
                    {% if pedido.situacao == 'a' %}
                    <td class="border_bottom"><strong>Aberto</strong></td>
                    {% elif pedido.situacao == 'b' %}
                    <td class="border_bottom"><strong>Fechado</strong></td>
                    {% elif pedido.situacao == 'c' %}
                    <td class="border_bottom"><strong>Cancelado</strong></td>
                    {% else %}
                    {% endif %}
                    <td class="border_bottom"><strong>{{ pedido.data|date:"SHORT_DATE_FORMAT" }}</strong></td>
                    <td class="border_bottom"><strong>{{ pedido.fornecedor|title|truncatechars:35 }}</strong></td>


                    <td class="border_bottom"><strong>{{ pedido.cliente|upper }}</strong></td>


                    <td class="border_bottom"><strong>R$ {{ pedido.preco_produto|intcomma  }}</strong></td>
                    <td class="border_bottom"><strong>{{ pedido.comissaoc|intcomma }} %</strong></td>
                    <td class="border_bottom"><strong> {{ pedido.produto  }} </strong></td>


                    {% if pedido.produto == "Arroz em Casca" %}
                    <td class="border_bottom" align=center><strong>{{ pedido.quantidade_pedido|div:50|floatformat:"0"}}
                            Scs </strong></td>
                    {% else %}
                    <td class="border_bottom" align=center><strong>{{ pedido.quantidade_pedido|div:30|floatformat:"0"}}
                            Fds </strong></td>
                    {% endif %}
                    <td class="border_bottom" align=center><strong>{{ pedido.quantidade_pedido|intcomma }} Kg </strong>
                    </td>
                    {% if pedido.carregado == 0 %}
                    <td class="border_bottom" align=center><strong> - </strong></td>
                    {% else %}
                    <td class="border_bottom" align=center><strong><strong>{{ pedido.carregado }} Kg</strong></strong>
                    </td>
                    {% endif %}
                    {% if pedido.saldo == 0 %}
                    <td class="border_bottom" align=center><strong> - </strong></td>
                    {% else %}
                    <td class="border_bottom" align=center><strong>{{ pedido.saldo }} Kg</strong></td>
                    {% endif %}
                </tr>

                {% endfor %}
            </tbody>
        </table>
        <br>


        <!--------------------------Cargas-------------------------------------------------------------->



        {% if cargas %}

        <div class="container">
            <div class="row">

                <div class="col" align="center">
                    <h2><span class="badge badge-primary badge-pill">
                            Relatório Comissões
                        </span></h2>
                </div>

            </div>
        </div>

        <div class="container-fluid">
            <table class=" width table table-striped table-sm table-hover" align="center">



                <thead align="center" class="table-bordered thead-dark">

                    <tr>
                        <th scope="col"><a class="text-white fa fa-sort-desc"></a></th>
                        <th scope="col"><strong>Contrato</strong></th>
                        <th scope="col"><strong>Data</strong></th>
                        <th scope="col"><strong>Fornecedor</strong></th>
                        <th scope="col"><strong>Placa</strong></th>
                        <th scope="col"><strong>Motorista</strong></th>
                        <th scope="col"><strong>NF</strong></th>
                        <th scope="col"><strong> Preço</strong></th>
                        <th scope="col"><strong> Comissão</strong></th>
                        <th scope="col"><strong>Peso</strong></th>
                        <th scope="col"><strong>Sacos</strong></th>

                        {% if notafiscal2 %}
                        <th scope="col"><strong>NF 2</strong></th>
                        {% else %}
                        {% endif %}
                        <th scope="col"><strong>Valor NF </strong></th>
                        <th scope="col"><strong>Comissao </strong></th>
                        <th scope="col"><strong>Pago </strong></th>
                        <th scope="col"><strong>A Receber </strong></th>

                    </tr>


                </thead>

                <tbody class="align-text-bottom table-borderless">

                    {% for carga in cargas %}
                    {% for pedido in pedidos %}
                    {% if carga.situacao == 'Carregado' %}

                    <tr align="center">
                        <td class="border-left ">{{ forloop.parentloop.counter }}</td>
                        <td><b>{{ carga.pedido }}</b></td>
                        <td><b>{{ carga.data|date:"SHORT_DATE_FORMAT" }}</b></td>
                        <td><b>{{ carga.pedido.fornecedor.nome|title|truncatechars:28 }}
                            </b></td>
                        <td><b>
                                {{ carga.placa|upper|slice:":3"}}-{{ carga.placa|upper|slice:"3:"}}</b></td>
                        <td><b>{{ carga.motorista|title }}</b></td>

                        {% if carga.notafiscal == None %}
                        <td class="text-danger"><strong>Sem NF</strong></td>
                        {% elif carga.notafiscal|length <= 4 %}
                        <td><b>
                                {{ carga.notafiscal }}
                            </b></td>
                        {% elif carga.notafiscal|length <= 6 %}
                        <td><b>
                                {{ carga.notafiscal|slice:"-6:-3" }}.{{ carga.notafiscal|slice:"-3:" }}
                            </b></td>
                        {% elif carga.notafiscal|length > 6 and carga.notafiscal|length < 8 %}
                        <td><b>
                                {{ carga.notafiscal|slice:"-9:-6" }}.{{ carga.notafiscal|slice:"-6:-3" }}.{{ carga.notafiscal|slice:"-3:" }}
                            </b></td>

                        {% elif carga.notafiscal|length == 8 %}
                        <td><b>
                                0{{ carga.notafiscal|slice:"-9:-6" }}.{{ carga.notafiscal|slice:"-6:-3" }}.{{ carga.notafiscal|slice:"-3:" }}
                            </b></td>
                        {% elif carga.notafiscal|length > 8 %}
                        <td><b>
                                {{ carga.notafiscal|slice:"-9:-6" }}.{{ carga.notafiscal|slice:"-6:-3" }}.{{ carga.notafiscal|slice:"-3:" }}
                            </b></td>
                        {% else %}
                        <td><b>{{ carga.notasfiscal }}</b></td>
                        {% endif %}
                        <td><b>R$ {{ pedido.preco_produto|intcomma  }}</b></td>
                        <td><b>{{ pedido.comissaoc|intcomma }} %</b></td>

                        {% if notafiscal2 %}
                        <td><b>{{ carga.notasfiscal2 }}</b></td>
                        {% else %}
                        {% endif %}
                        <td><b>{{ carga.peso|intcomma }} Kg </b></td>
                        <td><b>{{ carga.peso|div:50|intcomma }} Scs </b></td>
                        {% if carga.valornf == None %}
                        <td><b>R$ &nbsp; - </b></td>
                        {% else %}
                        <td><b>R$ {{ carga.valornf }}</b></td>
                        {% endif %}
                        <td><b>R$ {{ carga.comissaocasca|floatformat:2 }}</b></td>
                        {% if carga.vpcomissaoc == 0 and carga.pgcomissao == True %}
                        <td align="center"><b>R$ 0,00 </b></td>
                        {% elif carga.vpcomissaoc == 0 and carga.pgcomissao == False %}
                        <td align="center"><i>R$ &nbsp; - </i> </td>

                        {% elif carga.vpcomissaoc == None %}
                        <td align="center"><b> - </b></td>
                        {% elif carga.vpcomissaoc|floatformat:2 != carga.comissaocasca|floatformat:2 %}
                        <td class="text text-warning"><b>R$ {{ carga.vpcomissaoc|floatformat:2 }}</b></td>
                        {% else %}
                        <td><b>R$ {{ carga.vpcomissaoc|floatformat:2 }}</b></td>
                        {% endif %}
                        {% if carga.pgcomissao == True %}
                        <td align="center" class="border-right"><b> R$ 0,00</b></td>
                        {% elif carga.vpcomissaoc == 0 and carga.pgcomissao == True %}
                        <td align="center" class="border-right"><b> R$ 0,00</b></td>
                        {% elif carga.vpcomissaoc == 0 and carga.pgcomissao == False %}
                        <td class="border-right"><b> R$ {{ carga.comissaocasca|floatformat:2 }}</b></td>
                        {% else %}
                        <td align="center"><b> - </b></td>
                        {% endif %}

                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                    </tr>
                    <td colspan="1" class="border-top border-dark"></td>
                    <td colspan="1" class="border-top border-dark"></td>
                    <td colspan="1" class="border-top border-dark"></td>
                    <td colspan="3" class="border-top border-dark"></td>
                    <td align="right" colspan="1" class="border-top border-dark"></td>


                    <td colspan="1" class="border-top border-dark"></td>
                    <td align="center" colspan="1" class="border-top border-dark"><strong><i>TOTAIS</i></strong></td>
                    <td align="center" class="border-top border-dark"><i><strong>{{ totalpeso.peso__sum|intcomma }}
                                Kg</i><strong></td>
                    <td align="center" class="border-top border-dark">
                        <i><strong>{{ totalpeso.peso__sum|div:50|intcomma }}
                                Scs</i><strong></td>

                    <td align="center" class="border-top border-dark"><i><strong>R$ {{ totalnf.valornf__sum|intcomma }}
                        </i><strong></td>

                    {% for pedido in pedidos %}
                    <td align="center" class="border-top border-dark"><i><strong>R$
                                {{ pedido.totalcomissaocasca|floatformat:2 }}
                        </i><strong></td>
                    {% endfor %}
                    {% if totalpago.vpcomissaoc__sum == 0 or totalpago.vpcomissaoc__sum == None %}
                    <td align="center" class="border-top border-dark"><i>R$ &nbsp; - </i> </td>
                    {% else %}
                    <td align="center" class="border-top border-dark"><i><strong>R$
                                {{ totalpago.vpcomissaoc__sum|floatformat:2 }}
                        </i><strong></td>
                    {% endif %}
                    {% for pedido in pedidos %}
                    {% if totalaberto.vpcomissaoc__count == 0 %}
                    <td align="center" class="border-top border-dark"><b> R$ 0,00 </b></td>
                    {% else %}
                    <td align="center" class="border-top border-dark"><i><strong>R$
                                {{ pedido.saldototalcomissaocasca|floatformat:2 }}
                        </i><strong></td>

                    {% endif %}
                    {% endfor %}




                </tbody>
            </table>
        </div>
        {% else %}
        <br>
        <br>
        <br>
        <div class="d-flex justify-content-center">
            <h1><span class="badge badge-danger badge-pill">Pedido ainda sem Cargas!!</span></h1>
        </div>


        {% endif %}

    </body>

</div>
















</body>
<!-- jQuery -->
<script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="{% static 'js/popper.min.js' %}"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="{% static 'js/mdb.min.js' %}"></script>
<!-- Your custom scripts (optional) -->
<script type="text/javascript"></script>
<!-- MDBootstrap Datatables  -->
<script type="text/javascript" src="{% static 'js/addons/datatables.min.js' %}"></script>
<script>
    $(document).ready(function () {
        $('#cargas').DataTable({
            "order": [[3, "asc"]]
        });
        $('.dataTables_length').addClass('bs-select');
    });

    window.setTimeout(function () {
        $(".alert").fadeTo(500, 0).slideUp(500, function () {
            $(this).remove();
        });
    }, 3000);
</script>